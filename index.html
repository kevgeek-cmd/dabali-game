<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DABALI üá®üáÆ</title>
    <link rel="stylesheet" href="style.css?v=6">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8B4513">
    <link rel="icon" type="image/png" href="assets/icone_dabali.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DABALI">
    <link rel="apple-touch-icon" href="assets/icone_dabali.png">
    <link rel="apple-touch-startup-image" href="assets/splash.jpg">
</head>
<body>
    <div id="splash-screen">
        <img src="assets/icone_dabali.png" alt="Dabali Logo">
        <div class="loading-bar">
            <div class="progress"></div>
        </div>
        <button id="start-btn" class="hidden">JOUER</button>
    </div>

    <!-- Drawer Menu -->
    <div id="drawer-overlay" class="hidden"></div>
    <div id="drawer-menu">
        <div class="drawer-header">
            <h2>MENU</h2>
            <button id="close-drawer"><i class="fas fa-times"></i></button>
        </div>
        <div class="drawer-content">
            <div class="drawer-item">
                <span>Son</span>
                <label class="switch">
                    <input type="checkbox" id="sound-toggle" checked>
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="drawer-item" id="open-level-map" style="cursor:pointer;">
                <span>Carte des niveaux</span>
                <i class="fas fa-map"></i>
            </div>
            <div class="drawer-item" id="promo-code-btn" style="cursor:pointer;">
                <span>Code partenaire</span>
                <i class="fas fa-gift"></i>
            </div>
            <div class="drawer-item">
                <span>Vibrations</span>
                <label class="switch">
                    <input type="checkbox" id="vibration-toggle" checked>
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="drawer-item">
                <span>Mode Nuit</span>
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider round"></span>
                </label>
            </div>
            
            <div class="drawer-item" id="quit-btn" style="cursor:pointer; color: red;">
                <span>Quitter le jeu</span>
                <i class="fas fa-sign-out-alt"></i>
            </div>

            <div class="credits-section">
                <h3>Cr√©dits</h3>
                <p>Ce jeu est d√©velopp√© par <strong>Assamoi Kevin St√©phane</strong></p>
                <p class="role">R√©f√©rent Digital</p>
                <p class="vibe">‚ú® C'est du Vibe Coding avec l'IA ‚ú®</p>
            </div>
        </div>
    </div>

    <div id="game-container">
        <div id="header">
            <div class="header-top">
                <button id="menu-btn"><i class="fas fa-bars"></i></button>
                <div class="level-badge">
                    NIVEAU <span id="level-display">1</span>
                    <div id="level-group-display"></div>
                </div>
                <div class="timer-badge">‚è≥ <span id="timer-display">01:30</span></div>
                <button id="pause-btn" class="header-btn"><i class="fas fa-pause"></i></button>
            </div>
            <div class="header-stats">
                <div class="stat-box">
                    <span class="stat-icon">üîÑ</span>
                    <span id="moves-display">20</span>
                </div>
                <div class="stat-box">
                    <span class="stat-icon">‚≠ê</span>
                    <span id="score-display">0</span>
                    <span id="free-super-badge" class="hidden">0</span>
                </div>
            </div>
        </div>

        <!-- Name Input Modal -->
        <div id="name-modal-overlay" class="modal-overlay">
            <div class="modal-content">
                <h2 class="modal-title">Bienvenue !</h2>
                <p class="modal-message">Entre ton pr√©nom chef :</p>
                <input type="text" id="player-name-input" placeholder="Ton pr√©nom" maxlength="12" autocomplete="off">
                <button id="start-game-btn" class="modal-btn">C'est parti !</button>
            </div>
        </div>

        <!-- Tutorial Overlay -->
        <div id="tutorial-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 class="modal-title">Comment jouer</h2>
                <p class="modal-message">
                    Aligne 3 ingr√©dients ou plus pour pr√©parer ton Dabali.<br>
                    Glisse les tuiles ou tape deux cases pour les √©changer !
                </p>
                <button id="tutorial-ok-btn" class="modal-btn">C'est bon, chef !</button>
            </div>
        </div>

        <div id="game-board">
            <div id="grid"></div>
            <div id="board-tip">
                Astuce : aligne 4 ingr√©dients pour d√©clencher un super combo de ligne.
            </div>
        </div>

        <div id="combo-message" class="hidden"></div>
        <div id="combo-effect" class="hidden"></div>
        
        <!-- Promo Code Modal -->
        <div id="promo-modal-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 class="modal-title">Code partenaire</h2>
                <p class="modal-message">Entre ton code pour d√©bloquer un bonus :</p>
                <input type="text" id="promo-code-input" placeholder="CODE" maxlength="20" autocomplete="off">
                <button id="promo-submit-btn" class="modal-btn">Valider</button>
                <p id="promo-message"></p>
            </div>
        </div>

        <!-- Ad Modal -->
        <div id="ad-modal-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 class="modal-title">Pause pub Dabali</h2>
                <p id="ad-partner-name" class="modal-message"></p>
                <p id="ad-code-hint" class="modal-message"></p>
                <p class="modal-message">La pub se termine dans <span id="ad-countdown">10</span>s</p>
                <button id="ad-copy-btn" class="modal-btn secondary-btn">Copier le code</button>
                <button id="ad-continue-btn" class="modal-btn" disabled>Continuer</button>
            </div>
        </div>

        <div id="avatar-container">
            <div id="avatar-body"></div>
            <div id="avatar-plate"></div>
        </div>

        <div id="footer-goals">
            <!-- Goals generated dynamically -->
        </div>
    </div>

    <!-- Level Select -->
    <div id="level-select-overlay" class="modal-overlay hidden">
        <div id="level-select-content">
            <h2 class="modal-title">Choisis ton niveau</h2>
            <div id="level-grid"></div>
            <button id="level-select-close" class="modal-btn">Fermer</button>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <div id="modal-content" class="modal-content">
            <h2 id="modal-title">Niveau Termin√© !</h2>
            <div id="modal-stars">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
            </div>
            <p id="modal-message">Score: 1250</p>
            <button id="modal-btn">Niveau Suivant</button>
        </div>
    </div>

    <script src="script.js?v=6"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => {
                    console.log('SW enregistr√©');
                    // Check for updates
                    reg.onupdatefound = () => {
                        const installingWorker = reg.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    console.log('Nouveau contenu disponible - Veuillez rafra√Æchir.');
                                    // Optional: force reload
                                    // window.location.reload(); 
                                }
                            }
                        };
                    };
                })
                .catch(err => console.log('Erreur SW', err));
        }
    </script>
</body>
</html>
